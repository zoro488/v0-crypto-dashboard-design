rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    //  REGLAS DE DESARROLLO - CHRONOS SYSTEM
    // 锔 IMPORTANTE: Cambiar allowAccess() a isAuthenticated() en producci贸n
    
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // DESARROLLO: Permitir acceso sin autenticaci贸n
    function allowAccess() {
      return true; // TODO: Cambiar a isAuthenticated() en producci贸n
    }

    // ===================================================================
    // TODAS LAS COLECCIONES DEL SISTEMA CHRONOS
    // ===================================================================
    
    // Bancos y Movimientos
    match /bancos/{docId} {
      allow read, write: if allowAccess();
    }
    match /movimientos/{docId} {
      allow read, write: if allowAccess();
    }
    match /transferencias/{docId} {
      allow read, write: if allowAccess();
    }
    match /abonos/{docId} {
      allow read, write: if allowAccess();
    }
    match /ingresos/{docId} {
      allow read, write: if allowAccess();
    }
    match /gastos/{docId} {
      allow read, write: if allowAccess();
    }

    // Ventas y Clientes
    match /ventas/{docId} {
      allow read, write: if allowAccess();
    }
    match /clientes/{docId} {
      allow read, write: if allowAccess();
    }

    // Distribuidores y rdenes
    match /distribuidores/{docId} {
      allow read, write: if allowAccess();
    }
    match /ordenes_compra/{docId} {
      allow read, write: if allowAccess();
    }

    // Almac茅n
    match /almacen/{docId} {
      allow read, write: if allowAccess();
    }
    match /almacen_productos/{docId} {
      allow read, write: if allowAccess();
    }
    match /almacen_entradas/{docId} {
      allow read, write: if allowAccess();
    }
    match /almacen_salidas/{docId} {
      allow read, write: if allowAccess();
    }

    // Legacy
    match /gastos_abonos/{docId} {
      allow read, write: if allowAccess();
    }

    // Dashboard
    match /dashboard_totales/{docId} {
      allow read, write: if allowAccess();
    }
    match /dashboard_paneles/{docId} {
      allow read, write: if allowAccess();
    }

    // Configuraci贸n y Logs
    match /configuracion/{docId} {
      allow read, write: if allowAccess();
    }
    match /logs/{docId} {
      allow read, create: if allowAccess();
      allow update, delete: if false; // Logs inmutables
    }
    match /cortes_bancarios/{docId} {
      allow read, write: if allowAccess();
    }
    match /productos/{docId} {
      allow read, write: if allowAccess();
    }
    match /dashboard_stats/{docId} {
      allow read, write: if allowAccess();
    }
    match /audit_logs/{docId} {
      allow read, write: if allowAccess();
    }

    // Usuarios
    match /usuarios/{userId} {
      allow read, write: if allowAccess();
    }

    // Tablas por banco - Ingresos
    match /boveda_monte_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /boveda_usa_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /profit_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /leftie_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /azteca_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /flete_sur_ingresos/{docId} { allow read, write: if allowAccess(); }
    match /utilidades_ingresos/{docId} { allow read, write: if allowAccess(); }

    // Tablas por banco - Gastos
    match /boveda_monte_gastos/{docId} { allow read, write: if allowAccess(); }
    match /boveda_usa_gastos/{docId} { allow read, write: if allowAccess(); }
    match /profit_gastos/{docId} { allow read, write: if allowAccess(); }
    match /leftie_gastos/{docId} { allow read, write: if allowAccess(); }
    match /azteca_gastos/{docId} { allow read, write: if allowAccess(); }
    match /flete_sur_gastos/{docId} { allow read, write: if allowAccess(); }
    match /utilidades_gastos/{docId} { allow read, write: if allowAccess(); }

    // Tablas por banco - Cortes
    match /boveda_monte_cortes/{docId} { allow read, write: if allowAccess(); }
    match /boveda_usa_cortes/{docId} { allow read, write: if allowAccess(); }
    match /profit_cortes/{docId} { allow read, write: if allowAccess(); }
    match /leftie_cortes/{docId} { allow read, write: if allowAccess(); }
    match /azteca_cortes/{docId} { allow read, write: if allowAccess(); }
    match /flete_sur_cortes/{docId} { allow read, write: if allowAccess(); }
    match /utilidades_cortes/{docId} { allow read, write: if allowAccess(); }

    // Denegar todo lo dem谩s
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
